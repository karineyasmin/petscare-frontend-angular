<div class="notification-list-container">
  <div class="page-header">
    <h1 class="page-title">
      <mat-icon class="title-icon">notifications</mat-icon>
      <span>Notificações</span>
      <span *ngIf="getUnreadCount() > 0" class="unread-badge" matBadge="{{ getUnreadCount() }}" matBadgeColor="accent"></span>
    </h1>
    <div class="header-actions">
      <button mat-raised-button color="primary" routerLink="/dashboard">
        <mat-icon>dashboard</mat-icon>
        Dashboard
      </button>
    </div>
  </div>

  <!-- Componente de filtro -->
  <app-notification-filter 
    [loading]="loading"
    (filterChange)="onFilterChange($event)"
  ></app-notification-filter>

  <!-- Indicador de carregamento -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Carregando notificações...</p>
  </div>

  <!-- Mensagem de erro -->
  <mat-card *ngIf="error" class="error-message">
    <mat-card-content>
      <mat-icon color="warn">error</mat-icon>
      {{ error }}
    </mat-card-content>
  </mat-card>

  <!-- Lista de notificações -->
  <div class="notification-table-container" *ngIf="!loading && !error && filteredNotifications.length > 0">
    <table mat-table [dataSource]="displayedNotifications" class="notification-table">
      
      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let notification">
          <mat-icon 
            [matTooltip]="notification.status === 'failed' ? notification.errorMessage || 'Falha no envio' : ''" 
            [class]="getStatusClass(notification.status)"
          >{{ getStatusIcon(notification.status) }}</mat-icon>
        </td>
      </ng-container>

      <!-- Date Column -->
      <ng-container matColumnDef="sentAt">
        <th mat-header-cell *matHeaderCellDef>Data</th>
        <td mat-cell *matCellDef="let notification">
          <div class="cell-content">
            {{ notification.formattedDate }}
            <mat-icon *ngIf="!notification.isRead" class="unread-icon" matTooltip="Não lida">mark_email_unread</mat-icon>
          </div>
        </td>
      </ng-container>

      <!-- Pet Column -->
      <ng-container matColumnDef="petName">
        <th mat-header-cell *matHeaderCellDef>Pet</th>
        <td mat-cell *matCellDef="let notification">{{ notification.petName || 'N/A' }}</td>
      </ng-container>

      <!-- Subject Column -->
      <ng-container matColumnDef="subject">
        <th mat-header-cell *matHeaderCellDef>Assunto</th>
        <td mat-cell *matCellDef="let notification" class="subject-cell" [class.unread]="!notification.isRead">
          {{ notification.subject }}
        </td>
      </ng-container>

      <!-- Email Column -->
      <ng-container matColumnDef="recipientEmail">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let notification">{{ notification.recipientEmail }}</td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Ações</th>
        <td mat-cell *matCellDef="let notification">
          <div class="action-buttons">
            <button mat-icon-button color="primary" matTooltip="Ver detalhes" (click)="openDetails(notification)">
              <mat-icon>visibility</mat-icon>
            </button>
            
            <button 
              mat-icon-button 
              [color]="notification.isRead ? 'basic' : 'accent'" 
              [matTooltip]="notification.isRead ? 'Já lida' : 'Marcar como lida'"
              (click)="markAsRead(notification)"
              [disabled]="notification.isRead">
              <mat-icon>{{ notification.isRead ? 'mark_email_read' : 'mark_as_unread' }}</mat-icon>
            </button>
            
            <button 
              mat-icon-button 
              color="warn" 
              matTooltip="Reenviar email" 
              *ngIf="notification.status === 'failed'"
              (click)="resendNotification(notification)">
              <mat-icon>send</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr 
        mat-row 
        *matRowDef="let row; columns: displayedColumns;"
        [class.unread-row]="!row.isRead"
        (click)="openDetails(row)"
      ></tr>
    </table>

    <!-- Paginação -->
    <mat-paginator 
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPageChange($event)"
      aria-label="Selecione a página">
    </mat-paginator>
  </div>

  <!-- Estado vazio - nenhuma notificação -->
  <div *ngIf="!loading && !error && filteredNotifications.length === 0" class="empty-state">
    <mat-icon>notifications_off</mat-icon>
    <h3>Nenhuma notificação encontrada</h3>
    <p>Não há notificações disponíveis para os filtros selecionados.</p>
  </div>
</div>